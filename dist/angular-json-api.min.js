(function(){"use strict";var t,n,e,r,u,i,o,s,a,l={}.hasOwnProperty,p=function(t,n){function e(){this.constructor=t}for(var r in n)l.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},c=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},h=[].slice;o=null,u="items must be an array and have $isArray attribute eq true",angular.module("json-api",["object-util"]).provider("jsonApi",function(){var t,n;n=null,t=null,this.idKey=function(t){return null==t?n:(n=t,this)},this.base=function(n){return null==n?t:(t=n,this)},this.$get=["jsonApiBuilder",function(e){var r,u;return u={},null!=n&&(u.idKey=n),null!=t&&(u.base=t),r=e.newClient(u)}]}).factory("jsonApiBuilder",["$http","_ou",function(t,n){var r;return o=n,r=new e({idKey:"id",http:t,base:"/"})}]),a=["meta","links","linked"],s={type:"$type",href:"$href",links:"$links"},n=function(){function t(t){null==t&&(t={}),angular.extend(this,t)}return t}(),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.prototype.updatePristineAttributes=function(t){return t.$pristineAttributes=this.getAttributes(t)},n.prototype.getAttributes=function(t){return o.filterKeysNot(t,/^\$/)},n.prototype.isUnchanged=function(t){return angular.equals(this.getAttributes(t),t.$pristineAttributes)},n.prototype.toJson=function(t){var n,e;return e={},n=o.mapKeys(t,{$id:this.idKey}),e[t.$type]=this.getAttributes(n),angular.toJson(e)},n.prototype.reservedMap=function(){var t;return t=angular.copy(s),t[this.idKey]="$id",t},n.prototype.fromJson=function(t){var n,e,r,u,i,s,l;r=angular.fromJson(t);for(e in r)c.call(a,e)<0&&(i=e);for(n=o.mapKeys(r[i],this.reservedMap()),u={},s=0,l=a.length;l>s;s++)e=a[s],null!=r[e]&&(u[e]=r[e]);return u.linked&&(u.linked=o.mapKeys(u.linked,this.reservedMap())),this.newItem({origin:r,type:i,root:u},n)},n.prototype.newItem=function(t,n){var e,r,u,i,o,s;switch(null==t&&(t={}),null==n&&(n={}),!1){case!Array.isArray(n):r=[],angular.copy(n,r),r.$isArray=!0;break;default:r={},angular.copy(n,r),r.$isArray=!1}for(u in t)i=t[u],r["$"+u]=i;if(r.$isArray)for(o=0,s=r.length;s>o;o++)e=r[o],e.$type=r.$type;return this.updatePristineAttributes(r),r},n.prototype.getLinked=function(t,n,e){var r,u,i,o,s,a,l;switch(!1){case null==n:if(r=null!=(s=t.$root)&&null!=(a=s.linked)?a[n]:void 0,null==r)return;switch(!1){case!e:for(i=0,o=r.length;o>i;i++)if(u=r[i],u.$id===e)return u;break;default:return r}break;default:return null!=(l=t.$root)?l.linked:void 0}},n}(n),t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return p(n,t),n.prototype.urlFor=function(){var t,n,e,r,u,i;if(!arguments[0])return""+this.base;switch(!1){case!angular.isObject(arguments[0]):n=arguments[0];break;default:n={type:arguments[0]}}switch(!1){case!angular.isObject(arguments[1]):n.query=arguments[1];break;case null==arguments[1]:n.id=arguments[1]}switch(i=n.url,t=n.id,u=n.type,r=n.query,null==u&&(u=n.$type),null==t&&(t=n.$id),!1){case null==i:return""+this.base+i;case!(null!=u&&null!=t):return""+this.base+u+"/"+t;case null==u:return e=""+this.base+u,n.query&&(e=""+e+"?"+o.objectToQuery(n.query)),e}},n.prototype.updateIn=function(){var t,n,e,r;return t=2<=arguments.length?h.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++],e=t.length?t.push(n)&&t:[n],this.update.apply(this,e).then(function(t){return o.replace(n,t)})},n.prototype.createIn=function(t,n){return this.create(t,n).then(function(t){return o.replace(n,t)})},n.prototype.getIn=function(){var t,n,e;return t=2<=arguments.length?h.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],this.get.apply(this,t).then(function(t){return o.replace(n,t)})},n.prototype.canLoadMore=function(t){var n,e,r;if(!t.$isArray)throw new Error(u);return n=null!=(e=t.$root)&&null!=(r=e.meta)?r.count:void 0,null==n?!0:n?t.$root.meta.count-t.length:0},n.prototype.loadMore=function(t,n){var e;if(!t.$isArray)throw new Error(u);return e={},null!=n&&(e.limit=n),e.skip=t.length,this.get(t,e).then(function(n){return function(e){var r,u,i,o,s,a;for(t.$root.meta=e.$root.meta,o=0,s=e.length;s>o;o++)i=e[o],t.push(i);if(r=n.getLinked(e)){!n.getLinked(t)&&r&&(t.$root.linked={}),a=[];for(u in r)n.getLinked(t)[u]||(n.getLinked(t)[u]=[]),a.push(function(){var n,r,o,s;for(o=this.getLinked(e,u),s=[],n=0,r=o.length;r>n;n++)i=o[n],s.push(this.getLinked(t)[u].push(i));return s}.call(n));return a}}}(this))},n.prototype.load=function(t){return this.get(t).then(function(n){return o.replace(t,n)})},n.prototype.update=function(){var t,n,e,r,u;return t=2<=arguments.length?h.call(arguments,0,u=arguments.length-1):(u=0,[]),n=arguments[u++],r=t.length?t:[n],e=this.urlFor.apply(this,r),this.http.put(e,this.toJson(n)).then(function(t){return function(n){return t.fromJson(n.data)}}(this))},n.prototype["delete"]=function(t){return this.http["delete"](this.urlFor({type:t.$type,id:t.$id})).then(function(){return!0})},n.prototype.create=function(t,n){return null==n&&(n={}),this.http.post(this.urlFor(t),this.toJson(n)).then(function(t){return function(n){return t.fromJson(n.data)}}(this))},n.prototype.get=function(){var t;return t=1<=arguments.length?h.call(arguments,0):[],this.http.get(this.urlFor.apply(this,t)).then(function(t){return function(n){return t.fromJson(n.data)}}(this))},n}(r),i=function(t){var n,e,r,u;n=new Function(t),e={},angular.copy(t,e);for(r in e)l.call(e,r)&&(u=e[r],n[r]=u);return n},e=function(){function n(t){null==t&&(t={}),this.defaults=angular.extend({},t)}return n.prototype.newClient=function(n){return null==n&&(n={}),n=angular.extend({},this.defaults,n),n.http=i(n.http),new t(n)},n}()}).call(this);