(function(){"use strict";var t,n,e,r,u,i,o,s,a={}.hasOwnProperty,l=function(t,n){function e(){this.constructor=t}for(var r in n)a.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t},p=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},c=[].slice;i=null,angular.module("json-api",["object-util"]).provider("jsonApi",function(){var t,n;n=null,t=null,this.idKey=function(t){return null==t?n:(n=t,this)},this.base=function(n){return null==n?t:(t=n,this)},this.$get=["jsonApiBuilder",function(e){var r,u;return u={},null!=n&&(u.idKey=n),null!=t&&(u.base=t),r=e.newClient(u)}]}).factory("jsonApiBuilder",["$http","_ou",function(t,n){var r;return i=n,r=new e({idKey:"id",http:t,base:"/"})}]),s=["meta","links","linked"],o={type:"$type",href:"$href",links:"$links"},n=function(){function t(t){null==t&&(t={}),angular.extend(this,t)}return t}(),r=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.updatePristineAttributes=function(t){return t.$pristineAttributes=this.getAttributes(t)},n.prototype.getAttributes=function(t){return i.filterKeysNot(t,/^\$/)},n.prototype.isUnchanged=function(t){return angular.equals(this.getAttributes(t),t.$pristineAttributes)},n.prototype.toJson=function(t){var n;return n={},n[t.$type]=this.getAttributes(t),angular.toJson(n)},n.prototype.reservedMap=function(){var t;return t=angular.copy(o),t[this.idKey]="$id",t},n.prototype.fromJson=function(t){var n,e,r,u,o,a,l;r=angular.fromJson(t);for(e in r)p.call(s,e)<0&&(o=e);for(n=i.mapKeys(r[o],this.reservedMap()),u={},a=0,l=s.length;l>a;a++)e=s[a],null!=r[e]&&(u[e]=r[e]);return u.linked&&(u.linked=i.mapKeys(u.linked,this.reservedMap())),this.newItem({origin:r,type:o,root:u},n)},n.prototype.newItem=function(t,n){var e,r,u,i,o,s;switch(null==t&&(t={}),null==n&&(n={}),!1){case!Array.isArray(n):r=[],angular.copy(n,r),r.$isArray=!0;break;default:r={},angular.copy(n,r),r.$isArray=!1}for(u in t)i=t[u],r["$"+u]=i;if(r.$isArray)for(o=0,s=r.length;s>o;o++)e=r[o],e.$type=r.$type;return this.updatePristineAttributes(r),r},n.prototype.getLinked=function(t,n,e){var r,u,i,o,s,a,l;switch(!1){case null==n:if(r=null!=(s=t.$root)&&null!=(a=s.linked)?a[n]:void 0,null==r)return;switch(!1){case!e:for(i=0,o=r.length;o>i;i++)if(u=r[i],u.$id===e)return u;break;default:return r}break;default:return null!=(l=t.$root)?l.linked:void 0}},n}(n),t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return l(n,t),n.prototype.urlFor=function(){var t,n,e,r,u,o;switch(!1){case!angular.isObject(arguments[0]):n=arguments[0];break;case null==arguments[0]:switch(n={type:arguments[0]},!1){case!angular.isObject(arguments[1]):n.query=arguments[1];break;case null==arguments[1]:n.id=arguments[1]}break;default:n={}}if(n.$href)return n.$href;switch(o=n.url,t=n.id,u=n.type,r=n.query,null==o&&(o=n.$href),null==u&&(u=n.$type),null==t&&(t=n.$id),!1){case null==o:return""+this.base+o;case!(null!=u&&null!=t):return""+this.base+u+"/"+t;case null==u:return e=""+this.base+u,n.query&&(e=""+e+"?"+i.objectToQuery(n.query)),e}},n.prototype.updateIn=function(t){return this.update(t).then(function(n){return i.replace(t,n)})},n.prototype.createIn=function(t,n){return this.create(t,n).then(function(t){return i.replace(n,t)})},n.prototype.getIn=function(){var t,n,e;return t=2<=arguments.length?c.call(arguments,0,e=arguments.length-1):(e=0,[]),n=arguments[e++],this.get.apply(this,t).then(function(t){return i.replace(n,t)})},n.prototype.load=function(t){return this.get({id:t.$id,type:t.$type}).then(function(n){return i.replace(t,n)})},n.prototype.update=function(t){return this.http.put(this.urlFor(t),this.toJson(t)).then(function(t){return function(n){return t.fromJson(n.data)}}(this))},n.prototype["delete"]=function(t){return this.http["delete"](this.urlFor({type:t.$type,id:t.$id})).then(function(){return!0})},n.prototype.create=function(t,n){return null==n&&(n={}),this.http.post(this.urlFor(t),this.toJson(n)).then(function(t){return function(n){return t.fromJson(n.data)}}(this))},n.prototype.get=function(){var t;return t=1<=arguments.length?c.call(arguments,0):[],this.http.get(this.urlFor.apply(this,t)).then(function(t){return function(n){return t.fromJson(n.data)}}(this))},n}(r),u=function(t){var n,e,r,u;n=new Function(t),e={},angular.copy(t,e);for(r in e)a.call(e,r)&&(u=e[r],n[r]=u);return n},e=function(){function n(t){null==t&&(t={}),this.defaults=angular.extend({},t)}return n.prototype.newClient=function(n){return null==n&&(n={}),n=angular.extend({},this.defaults,n),n.http=u(n.http),new t(n)},n}()}).call(this);